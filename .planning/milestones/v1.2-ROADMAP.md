# Milestone v1.2: Polish & Profiles

**Status:** SHIPPED 2026-02-06
**Phases:** 19-21
**Total Plans:** 6

## Overview

Make the app feel complete for daily use -- multiple taste profiles for different run types, reliable regeneration, and a guided first-run experience.

## Phases

### Phase 19: Regeneration Reliability
**Goal**: Users can shuffle and regenerate playlists instantly and reliably -- no crashes on cold start, no stale inputs after switching plans or profiles
**Depends on**: Phase 18 (existing playlist generation and one-tap regeneration)
**Requirements**: REGEN-01, REGEN-02, REGEN-03
**Success Criteria** (what must be TRUE):
  1. User can tap "shuffle" on a generated playlist and get a different song order instantly without a loading spinner or API call
  2. User can close the app completely, reopen it, and tap "generate" from the home screen without seeing a null-state error or crash
  3. User can switch their selected run plan or taste profile and the next generated playlist reflects the updated selection -- not a stale cached version
**Plans**: 2 plans

Plans:
- [x] 19-01-PLAN.md -- Readiness guards on library notifiers and instant shufflePlaylist() method
- [x] 19-02-PLAN.md -- Wire playlist screen UI to shufflePlaylist() and add Generate button

### Phase 20: Profile Polish
**Goal**: Multi-profile management is safe and verified -- destructive actions require confirmation, corrupt data degrades gracefully, and the full create/edit/delete/switch lifecycle is tested
**Depends on**: Phase 19 (regeneration must work for profile-switch-then-generate flow)
**Requirements**: PROF-01, PROF-02, PROF-03
**Success Criteria** (what must be TRUE):
  1. User sees a confirmation dialog before a taste profile is permanently deleted -- accidental taps do not destroy data
  2. App loads without crash even if stored taste profile JSON contains unknown enum values from a future or older app version
  3. User can create a new profile, edit it, select it, delete a different profile, and switch back -- all persisted correctly across app restart
**Plans**: 2 plans

Plans:
- [x] 20-01-PLAN.md -- TDD: Safe enum deserialization with orElse fallbacks and corrupt JSON resilience
- [x] 20-02-PLAN.md -- Delete confirmation dialogs and multi-profile lifecycle tests

### Phase 21: Onboarding
**Goal**: First-time users are guided through creating their first run plan and taste profile, arriving at a generated playlist without needing to discover the app's workflow themselves
**Depends on**: Phase 20 (onboarding creates profiles and plans -- those flows must be reliable)
**Requirements**: ONBD-01, ONBD-02, ONBD-03
**Success Criteria** (what must be TRUE):
  1. A brand-new user (no stored data) sees a guided onboarding flow on first launch -- not the regular home screen
  2. User can skip any onboarding step and still reach playlist generation with sensible defaults filled in
  3. After completing onboarding, the home screen shows the user's configured profile and run plan -- not an empty state prompt
  4. A returning user who has already completed onboarding never sees the onboarding flow again
**Plans**: 2 plans

Plans:
- [x] 21-01-PLAN.md -- Onboarding data layer, GoRouter redirect, and multi-step onboarding flow screens
- [x] 21-02-PLAN.md -- Home screen context-aware empty states for missing profile/plan

---

## Milestone Summary

**Key Decisions:**
- Completer-based ensureLoaded() for readiness guards (sync, idempotent)
- shufflePlaylist() reuses songPool with new Random seed (no API re-fetch)
- orElse fallbacks on all enum fromJson; tryFromJson+whereType for list filtering
- Delete confirmation via AlertDialog guarded by context.mounted
- Lifecycle tests use ProviderContainer with real SharedPreferences
- Onboarding flag pre-loaded in main.dart before GoRouter init (sync redirect)
- PageView with NeverScrollableScrollPhysics for onboarding step navigation
- Context-aware empty states on home screen with conditional setup cards

**Issues Resolved:**
- Fixed regeneration race condition on cold start (ensureLoaded guards)
- Fixed enum deserializers lacking orElse fallbacks (crash risk on corrupt data)

**Issues Deferred:**
- GetSongBPM API rate limits and danceability field availability unconfirmed
- Pre-existing test failure: widget_test.dart expects "Home Screen" text

**Technical Debt Incurred:**
None -- all phases executed cleanly with no deferred shortcuts.

---
*For current project status, see .planning/ROADMAP.md*
