---
phase: 01-project-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - lib/main.dart
  - .env
  - pubspec.yaml
  - android/app/src/main/AndroidManifest.xml
autonomous: false

user_setup:
  - service: supabase
    why: "Backend database and API"
    env_vars:
      - name: SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> anon/public key"
    dashboard_config:
      - task: "Create a Supabase project (if not already created)"
        location: "https://supabase.com/dashboard -> New Project"
      - task: "Create a test_table with columns: id (int8, primary key, auto-increment) and message (text)"
        location: "Supabase Dashboard -> Table Editor -> New Table"
      - task: "Disable RLS on test_table (for testing only)"
        location: "Supabase Dashboard -> Table Editor -> test_table -> RLS policies"

must_haves:
  truths:
    - "App launches and renders on Android emulator"
    - "App launches and renders on iOS simulator"
    - "App launches and renders in a web browser"
    - "Navigation between screens works on all platforms"
    - "Supabase connection reads and writes test data successfully"
  artifacts:
    - path: "lib/main.dart"
      provides: "Supabase initialization before app runs"
      contains: "Supabase.initialize"
    - path: ".env"
      provides: "Real Supabase credentials"
      contains: "SUPABASE_URL"
    - path: "android/app/src/main/AndroidManifest.xml"
      provides: "Internet permission for Android"
      contains: "android.permission.INTERNET"
  key_links:
    - from: "lib/main.dart"
      to: "Supabase"
      via: "Supabase.initialize with dotenv credentials"
      pattern: "Supabase\\.initialize"
    - from: ".env"
      to: "pubspec.yaml"
      via: "flutter assets declaration"
      pattern: "assets.*\\.env"
---

<objective>
Connect Supabase backend, configure platform-specific settings, and verify the app runs on all three target platforms (web, Android, iOS).

Purpose: Complete the Phase 1 foundation by proving the app works end-to-end on all platforms with a live backend connection.
Output: A running app on all three platforms that can read/write to Supabase.
</objective>

<execution_context>
@/Users/tijmen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tijmen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-foundation/01-RESEARCH.md
@.planning/phases/01-project-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Supabase connection and platform settings</name>
  <files>
    lib/main.dart
    .env
    pubspec.yaml
    android/app/src/main/AndroidManifest.xml
  </files>
  <action>
    1. Create `.env` file (copy from `.env.example`). The user will fill in real Supabase credentials before running.

    2. Add `.env` to flutter assets in `pubspec.yaml`:
       ```yaml
       flutter:
         assets:
           - .env
       ```

    3. Update `lib/main.dart` to initialize Supabase:
       - Add `import 'package:flutter_dotenv/flutter_dotenv.dart';`
       - Add `import 'package:supabase_flutter/supabase_flutter.dart';`
       - Make main() async
       - After WidgetsFlutterBinding.ensureInitialized(), add:
         ```dart
         await dotenv.load();
         await Supabase.initialize(
           url: dotenv.env['SUPABASE_URL']!,
           anonKey: dotenv.env['SUPABASE_ANON_KEY']!,
         );
         ```

    4. Ensure `android/app/src/main/AndroidManifest.xml` has internet permission:
       `<uses-permission android:name="android.permission.INTERNET" />`
       (Flutter create may already include this, but verify and add if missing)

    5. Run `flutter analyze` to verify no errors introduced.
  </action>
  <verify>
    - `flutter analyze` passes
    - `.env` file exists with placeholder or real credentials
    - `pubspec.yaml` has .env in assets
    - AndroidManifest.xml has INTERNET permission
  </verify>
  <done>
    Supabase initialization code in main.dart, .env file created, assets configured in pubspec.yaml, Android internet permission set.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify app on all three platforms with Supabase connection</name>
  <what-built>
    Flutter app with navigation (Home + Settings screens) and Supabase backend connection. The app should launch on web, Android emulator, and iOS simulator.
  </what-built>
  <how-to-verify>
    **Prerequisites:**
    1. Fill in `.env` with your real Supabase project URL and anon key
    2. Create a `test_table` in Supabase with columns: `id` (int8, auto-increment PK) and `message` (text)
    3. Disable RLS on test_table for testing

    **Web:**
    1. Run `flutter run -d chrome`
    2. Verify the Home screen renders with "Running Playlist AI" title
    3. Tap the Settings navigation â€” verify Settings screen loads
    4. Navigate back to Home

    **Android:**
    1. Start an Android emulator
    2. Run `flutter run -d <emulator-id>`
    3. Same navigation checks as web

    **iOS:**
    1. Start iOS simulator
    2. Run `flutter run -d <simulator-id>`
    3. Same navigation checks as web

    **Supabase (on any platform):**
    - Check the debug console for any Supabase connection errors on startup
    - (Optional) If a test write/read widget was added, verify data round-trips
  </how-to-verify>
  <resume-signal>Type "approved" if app works on all three platforms, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. App launches on web (flutter run -d chrome)
2. App launches on Android emulator
3. App launches on iOS simulator
4. Navigation works between Home and Settings on all platforms
5. No Supabase connection errors in debug console
</verification>

<success_criteria>
- App renders on all 3 platforms (web, Android, iOS)
- Navigation between screens works on all platforms
- Supabase initializes without errors
- Phase 1 success criteria fully met
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation/01-02-SUMMARY.md`
</output>
