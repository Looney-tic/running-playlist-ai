---
phase: 21-onboarding
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - lib/features/home/presentation/home_screen.dart
autonomous: true

must_haves:
  truths:
    - "Home screen shows regenerate card and cadence nudge when both run plan AND taste profile exist"
    - "Home screen shows a context-aware prompt to create a taste profile when no taste profile exists"
    - "Home screen shows a context-aware prompt to create a run plan when no run plan exists"
    - "After completing onboarding, home screen shows the user's configured profile and run plan -- not empty state prompts"
  artifacts:
    - path: "lib/features/home/presentation/home_screen.dart"
      provides: "Context-aware empty states based on profile and plan existence"
      min_lines: 100
  key_links:
    - from: "lib/features/home/presentation/home_screen.dart"
      to: "lib/features/taste_profile/providers/taste_profile_providers.dart"
      via: "Watches tasteProfileNotifierProvider for null check"
      pattern: "tasteProfileNotifierProvider"
    - from: "lib/features/home/presentation/home_screen.dart"
      to: "lib/features/run_plan/providers/run_plan_providers.dart"
      via: "Watches runPlanNotifierProvider for null check"
      pattern: "runPlanNotifierProvider"
---

<objective>
Add context-aware empty states to the home screen so users who are missing a taste profile or run plan see helpful prompts directing them to create one, rather than a generic navigation list.

Purpose: Covers ONBD-03. After onboarding, the home screen shows the user's configured profile and plan. If a user somehow lands on home without both (e.g., deleted their profile), they see actionable prompts rather than a broken state.

Output: Updated home_screen.dart with conditional UI based on profile/plan existence.
</objective>

<execution_context>
@/Users/tijmen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tijmen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-onboarding/21-01-SUMMARY.md

@lib/features/home/presentation/home_screen.dart
@lib/features/taste_profile/providers/taste_profile_providers.dart
@lib/features/run_plan/providers/run_plan_providers.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add context-aware empty states to home screen</name>
  <files>
    lib/features/home/presentation/home_screen.dart
  </files>
  <action>
    **Update `lib/features/home/presentation/home_screen.dart`:**

    Currently the home screen watches `runPlanNotifierProvider` and `strideNotifierProvider`. Add a watch on `tasteProfileNotifierProvider` (import from taste_profile_providers.dart).

    **Conditional UI logic:**

    1. **No taste profile AND no run plan (fresh state after profile/plan deletion):**
       Show a "Get Started" card at the top of the body:
       - Icon: Icons.music_note
       - Title: "Set up your music taste"
       - Subtitle: "Tell us what genres you like to run to"
       - onTap: navigate to `/taste-profile` (new profile creation)
       Then below it, a second card:
       - Icon: Icons.timer
       - Title: "Create a run plan"
       - Subtitle: "Set your distance and pace for playlist matching"
       - onTap: navigate to `/run-plan`

    2. **Has taste profile but no run plan:**
       Show the "Create a run plan" card (same as above) at the top.
       Below it, show the existing navigation buttons.

    3. **Has run plan but no taste profile:**
       Show the "Set up your music taste" card at the top.
       Below it, show the regenerate card + cadence nudge (existing logic).

    4. **Has both (normal state):**
       Current behavior — show the regenerate card, cadence nudge, and navigation buttons.

    **Additional detail for the setup cards:**
    - Use `Card` with `ListTile` pattern matching the existing regenerate card style.
    - Use `theme.colorScheme.secondaryContainer` as the card color to visually distinguish from the regenerate card (which uses default card color).
    - Add a trailing `Icon(Icons.arrow_forward_ios, size: 16)` to indicate tappability.

    **Taste profile display in regenerate area:**
    When both exist, add a small text line under the regenerate card subtitle showing the active taste profile name: e.g., "Profile: High Energy Mix" (or "Profile: Unnamed" if name is null). This satisfies the success criterion "home screen shows the user's configured profile."

    **Keep all existing navigation buttons** (Stride Calculator, My Runs, Taste Profiles, Generate Playlist, Playlist History) in all states — the setup cards are additional prompts, not replacements.
  </action>
  <verify>
    Run `dart analyze lib/features/home/presentation/home_screen.dart` — no errors.
    Verify the file imports `tasteProfileNotifierProvider`.
    Verify conditional logic: when tasteProfile == null, setup card is shown.
    Verify conditional logic: when runPlan == null, setup card is shown.
    Verify the active profile name appears when both profile and plan exist.
  </verify>
  <done>
    - Home screen shows "Set up your music taste" card when no taste profile exists
    - Home screen shows "Create a run plan" card when no run plan exists
    - Home screen shows regenerate card + profile name when both exist
    - All navigation buttons remain visible in all states
    - After onboarding completion, user sees their profile and plan on home screen
  </done>
</task>

</tasks>

<verification>
1. `dart analyze lib/features/home/` — no new errors
2. With no profile and no plan: two setup cards visible
3. With profile but no plan: run plan setup card visible, taste profile card absent
4. With plan but no profile: taste profile setup card visible, regenerate card visible
5. With both: regenerate card shows profile name, no setup cards
</verification>

<success_criteria>
- Context-aware empty states guide users to create missing profile or plan
- Regenerate area shows active profile name when fully configured
- Existing navigation buttons always visible
- No regression to existing home screen functionality
</success_criteria>

<output>
After completion, create `.planning/phases/21-onboarding/21-02-SUMMARY.md`
</output>
