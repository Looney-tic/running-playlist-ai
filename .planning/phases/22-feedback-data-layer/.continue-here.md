---
phase: 22-feedback-data-layer
task: 0
total_tasks: 4
status: planned
last_updated: 2026-02-07
---

<current_state>
Phase 22 is fully planned, researched, and verified. No execution has started.
2 plans in 2 waves, ready for `/gsd:execute-phase 22`.
</current_state>

<completed_work>

- Research: 22-RESEARCH.md written (codebase pattern analysis, SongKey normalization, persistence design)
- Plan 22-01 (wave 1): SongKey utility, SongFeedback model, SongFeedbackPreferences, lookupKey centralization
- Plan 22-02 (wave 2): SongFeedbackNotifier provider + full test suite
- Plan verification: PASSED (all requirements covered, dependencies correct, scope balanced)
</completed_work>

<remaining_work>

- Execute Plan 22-01 (wave 1): Create SongFeedback model, SongKey utility, SongFeedbackPreferences, refactor CuratedSong/BpmSong/PlaylistGenerator lookupKey
- Execute Plan 22-02 (wave 2): Create SongFeedbackNotifier + songFeedbackProvider, write unit tests + lifecycle tests
- Then continue to Phase 23 (Feedback UI & Scoring) through Phase 27 (Taste Learning)
</remaining_work>

<decisions_made>

- SongKey.normalize() centralized utility replaces inline key construction in CuratedSong and PlaylistGenerator
- BpmSong gets a lookupKey getter (new, non-breaking)
- SongFeedback model denormalizes display metadata (songTitle, songArtist, genre) for downstream library/learning use
- Map<String, SongFeedback> state (not List) for O(1) lookup
- SongFeedbackPreferences follows TasteProfilePreferences pattern (static class, single JSON blob, corrupt-entry resilience)
- SongFeedbackNotifier follows TasteProfileLibraryNotifier pattern (Completer-based ensureLoaded, optimistic updates)
</decisions_made>

<blockers>
None
</blockers>

<context>
This is the first phase of v1.3 (Song Feedback & Freshness). Pure data layer work -- no UI.
Model profile: quality (executor=opus, verifier=sonnet).
All patterns are established in the codebase -- this is pattern replication, not innovation.
The milestone has 6 phases (22-27), 13 requirements across feedback, freshness, and taste learning.
</context>

<next_action>
Run `/gsd:execute-phase 22` to execute both plans (wave 1 then wave 2).
</next_action>
