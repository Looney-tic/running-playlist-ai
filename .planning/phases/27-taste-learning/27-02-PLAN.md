---
phase: 27-taste-learning
plan: 02
type: execute
wave: 2
depends_on: ["27-01"]
files_modified:
  - lib/features/taste_learning/presentation/taste_suggestion_card.dart
  - lib/features/home/presentation/home_screen.dart
autonomous: true

must_haves:
  truths:
    - "Suggestion cards appear on the home screen when there are non-empty suggestions"
    - "Tapping Accept on a genre suggestion adds that genre to the active taste profile"
    - "Tapping Accept on an artist suggestion adds that artist to the active taste profile"
    - "Tapping Accept on a disliked-artist suggestion adds that artist to the disliked list"
    - "Tapping Dismiss hides the suggestion until evidence count grows by +3"
    - "No suggestion cards appear when there is no feedback or no active taste profile"
    - "Accepted suggestions are reflected in the next playlist generation (via updated taste profile)"
  artifacts:
    - path: "lib/features/taste_learning/presentation/taste_suggestion_card.dart"
      provides: "Reusable suggestion card widget with Accept and Dismiss actions"
      contains: "TasteSuggestionCard"
    - path: "lib/features/home/presentation/home_screen.dart"
      provides: "Suggestion cards integrated between review prompt and regenerate card"
      contains: "tasteSuggestionProvider"
  key_links:
    - from: "lib/features/home/presentation/home_screen.dart"
      to: "lib/features/taste_learning/providers/taste_learning_providers.dart"
      via: "ref.watch(tasteSuggestionProvider)"
      pattern: "tasteSuggestionProvider"
    - from: "lib/features/taste_learning/presentation/taste_suggestion_card.dart"
      to: "lib/features/taste_learning/providers/taste_learning_providers.dart"
      via: "onAccept and onDismiss callbacks invoke notifier methods"
      pattern: "acceptSuggestion|dismissSuggestion"
---

<objective>
Build the suggestion card UI and integrate it into the home screen so discovered taste patterns appear as actionable cards the user can accept or dismiss.

Purpose: This is the user-facing layer of taste learning -- it makes the pattern detection engine visible and actionable. Without this, the analyzer runs but produces no user value.

Output: TasteSuggestionCard widget and home screen integration showing suggestion cards with Accept/Dismiss actions.
</objective>

<execution_context>
@/Users/tijmen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tijmen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-taste-learning/27-RESEARCH.md
@.planning/phases/27-taste-learning/27-01-SUMMARY.md

@lib/features/taste_learning/domain/taste_suggestion.dart
@lib/features/taste_learning/providers/taste_learning_providers.dart
@lib/features/home/presentation/home_screen.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: TasteSuggestionCard widget</name>
  <files>
    lib/features/taste_learning/presentation/taste_suggestion_card.dart
  </files>
  <action>
Create a reusable suggestion card widget following the existing `_SetupCard` visual pattern from HomeScreen but with two action buttons instead of a trailing arrow.

```dart
import 'package:flutter/material.dart';
import 'package:running_playlist_ai/features/taste_learning/domain/taste_suggestion.dart';

class TasteSuggestionCard extends StatelessWidget {
  const TasteSuggestionCard({
    required this.suggestion,
    required this.onAccept,
    required this.onDismiss,
    super.key,
  });

  final TasteSuggestion suggestion;
  final VoidCallback onAccept;
  final VoidCallback onDismiss;

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);
    return Padding(
      padding: const EdgeInsets.symmetric(horizontal: 16).copyWith(bottom: 8),
      child: Card(
        color: theme.colorScheme.tertiaryContainer,
        child: Padding(
          padding: const EdgeInsets.all(12),
          child: Row(
            children: [
              Icon(
                _iconForType(suggestion.type),
                color: theme.colorScheme.onTertiaryContainer,
              ),
              const SizedBox(width: 12),
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      suggestion.displayText,
                      style: theme.textTheme.titleSmall,
                    ),
                    Text(
                      'Based on ${suggestion.evidenceCount} songs',
                      style: theme.textTheme.bodySmall,
                    ),
                  ],
                ),
              ),
              TextButton(
                onPressed: onDismiss,
                child: const Text('Dismiss'),
              ),
              const SizedBox(width: 4),
              FilledButton(
                onPressed: onAccept,
                child: const Text('Accept'),
              ),
            ],
          ),
        ),
      ),
    );
  }

  IconData _iconForType(SuggestionType type) {
    return switch (type) {
      SuggestionType.addGenre => Icons.library_music,
      SuggestionType.addArtist => Icons.person_add,
      SuggestionType.removeArtist => Icons.person_off,
    };
  }
}
```

Key design decisions:
- Use `tertiaryContainer` color (same as post-run review card) to distinguish from setup cards (secondaryContainer).
- Icon varies by suggestion type for quick visual scanning.
- Two action buttons: TextButton "Dismiss" (low emphasis) and FilledButton "Accept" (high emphasis).
- Evidence count shown as subtitle for transparency ("Based on 5 songs").
  </action>
  <verify>
Run `cd /Users/tijmen/running-playlist-ai && flutter analyze lib/features/taste_learning/presentation/taste_suggestion_card.dart` -- no errors.
  </verify>
  <done>TasteSuggestionCard widget exists with type-specific icons, Accept/Dismiss buttons, evidence count display, and tertiaryContainer color scheme. Compiles without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate suggestion cards into home screen</name>
  <files>
    lib/features/home/presentation/home_screen.dart
  </files>
  <action>
Modify `home_screen.dart` to show taste suggestion cards when available.

**1. Add imports:**
```dart
import 'package:running_playlist_ai/features/taste_learning/providers/taste_learning_providers.dart';
import 'package:running_playlist_ai/features/taste_learning/presentation/taste_suggestion_card.dart';
```

**2. In the `build` method, after the existing `unreviewedPlaylist` watch, add:**
```dart
final suggestions = ref.watch(tasteSuggestionProvider);
```

**3. Insert suggestion cards in the Column children, AFTER the post-run review prompt card and BEFORE the quick-regenerate card (the `if (hasPlan)` block):**

```dart
// Taste learning suggestion cards
...suggestions.map((suggestion) => TasteSuggestionCard(
  suggestion: suggestion,
  onAccept: () => ref
      .read(tasteSuggestionProvider.notifier)
      .acceptSuggestion(suggestion),
  onDismiss: () => ref
      .read(tasteSuggestionProvider.notifier)
      .dismissSuggestion(suggestion),
)),
```

The spread operator with `.map()` cleanly handles zero, one, or multiple suggestion cards.

Position reasoning: Suggestions are more important than regeneration (they improve future playlists) but less urgent than setup prompts and post-run review. Placing them between the review prompt and the regenerate card gives them appropriate visibility.
  </action>
  <verify>
Run `cd /Users/tijmen/running-playlist-ai && flutter analyze lib/features/home/presentation/home_screen.dart` -- no errors. Run `flutter test` -- existing tests pass (note pre-existing failures in widget_test.dart and 2 playlist error message tests are expected).
  </verify>
  <done>Home screen shows taste suggestion cards when tasteSuggestionProvider has non-empty suggestions. Accept calls acceptSuggestion (mutates taste profile and dismisses). Dismiss calls dismissSuggestion (hides until new evidence). Cards appear between post-run review prompt and regenerate card. All existing tests pass (modulo pre-existing failures).</done>
</task>

</tasks>

<verification>
1. `flutter analyze lib/features/taste_learning/ lib/features/home/presentation/home_screen.dart` -- no errors
2. `flutter test` -- all tests pass (modulo 3 pre-existing failures)
3. Home screen imports and watches tasteSuggestionProvider
4. TasteSuggestionCard renders suggestion.displayText and evidence count
5. Accept button calls notifier.acceptSuggestion which mutates taste profile
6. Dismiss button calls notifier.dismissSuggestion which persists evidence count
7. No auto-application of suggestions -- all changes require explicit user acceptance
</verification>

<success_criteria>
- Suggestion cards visually appear on home screen using tertiaryContainer color
- Accept action mutates the active taste profile (genres, artists, or dislikedArtists) via TasteProfileLibraryNotifier.updateProfile
- Dismiss action stores evidence count and hides the suggestion
- Cards disappear after accept or dismiss (notifier re-analyzes and updates state)
- Zero suggestions = no cards shown (clean empty state)
</success_criteria>

<output>
After completion, create `.planning/phases/27-taste-learning/27-02-SUMMARY.md`
</output>
