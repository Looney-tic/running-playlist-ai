---
phase: 28-songs-i-run-to-data-layer
task: 0
total_tasks: 4
status: planned
last_updated: 2026-02-08T22:16:31.144Z
---

<current_state>
Phase 28 is fully planned, researched, and verified. Ready to execute.
Two plans (28-01 and 28-02) are written in `.planning/phases/28-songs-i-run-to-data-layer/`.
No code has been written yet — execution has not started.
</current_state>

<completed_work>

- Milestone v1.4 defined: Smart Song Search & Spotify Foundation (6 phases, 13 requirements)
- 4 parallel research agents completed (Stack, Features, Architecture, Pitfalls)
- Research synthesized into SUMMARY.md
- REQUIREMENTS.md written with 13 REQ-IDs across 3 categories
- ROADMAP.md created with phases 28-33
- Phase 28 researched: 28-RESEARCH.md written (pure pattern replication of SongFeedback)
- Phase 28 planned: 28-01-PLAN.md and 28-02-PLAN.md written
- Phase 28 verified: plan checker passed all dimensions
</completed_work>

<remaining_work>

- Plan 28-01 (Wave 1): Domain model, persistence, provider, tests
  - Task 1: RunningSong model + RunningSongPreferences persistence
  - Task 2: RunningSongNotifier provider + unit/lifecycle tests
- Plan 28-02 (Wave 2, depends on 28-01): Screen, SongTile action, route, home nav
  - Task 1: RunningSongsScreen with list view, remove action, empty state
  - Task 2: SongTile bottom sheet "Add to Songs I Run To" action + route + home nav
- Phases 29-33 not yet planned or executed
</remaining_work>

<decisions_made>

- RunningSong is a separate model from SongFeedback (different user intent: proactive curation vs reactive feedback)
- SharedPreferences key: 'running_songs'
- StateNotifier + Completer async init pattern (matches all other features)
- SongKey.normalize(artist, title) for lookup key format
- "Add to Songs I Run To" action lives in SongTile play options bottom sheet
- RunningSongsScreen accessible from home screen navigation buttons
- Songs sorted by addedDate descending (most recently added first)
- RunningSongSource enum: curated, spotify, manual (with orElse fallback)
</decisions_made>

<blockers>
None — Phase 28 is straightforward pattern replication with no external dependencies.
</blockers>

<context>
Phase 28 is the foundation for all v1.4 features. It creates the "Songs I Run To" data layer
that Phase 29 (scoring integration), Phase 30 (search), and Phase 33 (Spotify import) all
depend on. The implementation follows the SongFeedback feature pattern exactly — same
StateNotifier + Completer + SharedPreferences stack. Research confirmed HIGH confidence
with zero new dependencies needed.

The milestone research also identified key architecture decisions for later phases:
- spotify package v0.15.0 for Spotify API (Phase 31+)
- flutter_secure_storage for OAuth tokens (Phase 31+)
- Flutter built-in Autocomplete widget for search (Phase 30)
- SongSearchService abstract interface for dual-source search (Phase 30)
</context>

<next_action>
Start with: `/gsd:execute-phase 28` to execute both plans. Plan 28-01 runs first (Wave 1),
then 28-02 (Wave 2). Both are autonomous. `/clear` first for fresh context window.
</next_action>
